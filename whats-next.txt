Tasks - Open

The Gameloop needs some depth:
* DONE Add workers for buildings
** DONE Need luxurys like in Anno
** With housing like in Anno and upgradeable buildings
* DONE A house supports X persons
** DONE Each building needs a worker
** DONE They live in houses
** If a building is suspended, no space in a house is consumed
** DONE Houses get luxury's delivered
** A house can be upgraded if luxury resources are available
*** Takes 10 ticks
*** Needs to be activated actively by hand
** A house consumes necessary luxury's every  50 Ticks
*** If not available, it is downgraded. This is instant
** Supports improved workers
*** lvl 1 House supports 2 Lvl 1 workers and 1 lvl 2 workers
*** Lvl 2 House supports 2 lvl 2 workers and 1 lvl 3 workers - Needs 1 Fish as luxury
*** Lvl 3 House supports 2 lvl 3 workers and 1 lvl 4 workers - Needs 1 Steak and 1 Goldring as luxury
Vielleicht hier die Zahlen noch ändern
Irgendwie wirkt Gold auch zu früh als Luxusgut

Statistics
* DONE Create a function, which calculates the housing demand for all buildings
** DONE Create a function, which counts buildings of a specific type
* DONE Create a function, which calculates the overall luxury demand for all houses
* Create a function which counts items in transport
* Create a function which counts items in storage
* Create a function which counts items in production

Housing
* Add Housing Buildings with demand
** DONE Add HouseLvl1
** Add HouseLvl2
** Add HouseLvl3
* If a house is idle (no luxurys) then don't Allow use of it's spaces
**** DONE Buildings need a "Worker assigned" Boolean
**** A house should knno where it's inhabitans work
**** A production building should know where it's workers live
**** Add a function which resets worker assigned
**** D Add a function which assigns workers to houses
***** Function to query available housing
**** Show overlay color, if a building has no worker
*** regular production should ignore houses.
*** Maybe it's easier to use an own demand prototype list in building. Will this be easier to understand?
* DONE Add a property which specifies the available space.
** DONE Add a building derivied type "House"
*** DONE all buildings are derived from "House"

HousingAlgorithmus
* DONE Add a new section in game loop
* D Before production. Search for all *houses* without a running production
** . For each one found, check if resources available
**  if one is found without, then remove workers from production buildings
** Before production, check if worker is assigned


* Housing
1 Buildable Houses
2 Contain lists of buildings which workers are housed
2.1 A data structure with references to the coordinates?
3 Need luxury resources. i.e. Food, Beer, Cloth ..

* Worker lvls
Townhall --
Lumberjack - 1
Forester - 1
Stonemason - 1
Fletcher - 2
Lumbermill - 2
Tower - 2
Road --
Pyramid --

Fisherman - 1
Pig Farmer - 2
Wheat farmer - 2
Butcher - 2
Gold miner - 3
Coal Miner - 3
Iron Miner - 4
Smelter - 4
Jewler - 3

Production chains:
Building     | produces | requirement    | Needed by
--------------------------------------------
Fisherman    | Fish     | water          | House

Wheat farmer | Wheat    | grassland      | Pig farmer
Pig farmer   | Pigs     | wheat          | Butcher
Butcher      | Steaks   | pigs           | House

Gold miner   | gold ore | mountain       | Jewler
Coal miner   | coal     | mountain       | Jewler
Jewler       | Goldring | gold ore, coal | House


Iron for pyramid?

1 pyramid
1 fletcher
2 forester
2 lumberjack
1 lumbermill
1 smelter
1 iron mine
2 coal mine
4 tower
1 pig farmer
1 wheat farmer
1 butcher
1 gold mine
1 jeweler
2 fisher

3 lvl 1 house
4 lvl 2 house
2 lvl 3 house

lvl 1 ||||||
lvl 2 |||||||||
lvl 3 ||||
lvl 4 ||

--------------------------------------

Bug
* DONE Scrollable region needs to be expanded to south. Because the app bar blocks some space

Refactor
* MapManager/ TransportManager does to much stuff
** Try to move some stuff down
*** DONE MapManager
*** TransportManager
* GameState Redesign Ideas:
** Currently it handles sideeffects of other actions.
*** I.E. If a destruction of a building is requested, it deletes all items associated

Infrasturucture

Graphics
Ideas: https://imgur.com/t/rts/swDzaNG
* DONE Two Step graphics: One idea to create some life in the graphics is to animate them
** DONECreate a slightly different second picture which alternates every second
** DONE Fletcher
** DONE Stonemason
* DONE Building graphics
**DONE Lumberjack- normal
**DONE Lumberjack- construction
**DONE Fletcher - normal
**DONE Fletcher - construction
**DONE Tower - normal
**DONE Tower - construction
**DONE Pyramid - normal
**DONE Pyramid - construction
**DONE Forester - normal
**DONE Forester - construction
** DONE Spawner
** DONE Zombie
*DONE Update Road graphics
**DONE All directions
*DONE Add graphics - for in transport items
**DONE Wood
**DONE Lumber
**DONE Stone
**DONE Arrow
*DONE Add ground graphics
* DONE Allow animated graphics.
** DONE If automatic RunLoop is activated, there should be an in between steps between all steps. In this steps, only in between graphics are drawn
DONE 1 - 0ms
DONE 2 - 1000ms
* DONE Add Animation infrastucture
** DONE Add 3 tick Explosion animation
** Make a nice flame/explosion icon
* Bug: Just after starting, the screen flickers, like reloading the app. Whats the issue here?
* Bug: View.generateViewId() creates error message "Invalid ID" in logcat, but seems to work anyway?

Combat
* DONE Tower only requests arrows, if its empty. The requesting can be updated after each shot
* DONE Set a spawner every 200 ticks
** DONE Remove initial spawner
** DONE Tower shoots arrows <--
***DONE Tower should have up to 3 Arrows
*** DONE Request arrows for 'production'
**** DONE Bug: Arrow disappears, after dilivery into tower
*** DONE Add range property
**** DONE Find a Target within range.
**** DONE Every tower searches its surrounding each tick for a valid target
*** DONE The tower will shoot an arrow in a straight line at a zombie within range
**** DONE This is a one tick action, but show an animation at the full shooting path
***** Shooting animation tower
***** red line in the path
***** Get hit animation at zombie
** DONE Add ammunition for towers as new ressource which needs to be in production
*** 1 Dmg, later a dmg property?
*** Progressbar for reload (production)
** DONE Zombies spawner in SE map border. Created with Townhall
** DONE Spawn a Zombie every 100 Ticks (Production)
*** DONE Add Zombie graphics
*** DONE Zombies move 1 tile per tick
**** DONE Zombies ignore Roads and spawners
*** DONE At the moment the old zombies are not deleted in a proper way. so the zombies are blurred over the map
** Buildings have Health
*** DONE 1 At the beginning
*** DONE Zombies explode when they reach a building dealing 1 dmg. So the Building is destroyed
**** DONE Add explosion animation
* Mobs dont attack buildings without resources delivered or in construction or finished

Map

Building
* DONE Add Lumbermill building
** DONE Takes Wood and Produces Lumber
** DONE Jumps production? sometimes when wood is delivered it produces for two ticks
* DONE Disable a building
** DONE This will stop any resources being delivered.
** DONE Works for construction and production
** DONE Color cell Magenta if delivery is stopped
* DONE requiresProduction/requiresConstruction: MutableList<Resource> - Use an immutable list?
* DONE Construction shall consume the items for construction, at the beginning of construction
** DONE Add a fletcher which produces 1 arrow from 1 wood
** DONE Bug: Buildings are not constructing, if the are additional ressources in production.
*** Example is the tower if an arrow is in front of the list
** Add an option to delete a building
* DONE Add Building StoneMason, needs 2 Wood
** DONE Produces stone every 10 Ticks
** DONE Consumes WorldResource Rock
* DONE Monument
** DONE Add Build Pyramids for 100 Wood
* DONE Add Forester
** DONE Production, plants a tree every 10 ticks
*** DONE Add some random where is planted?
*** DONE Trees are planted in the water currently
* DONE Add ShuffledRandomNeighbour to FindWorldResource

Dialog

Production
* Lumberjack
** DONE Only Produces if tree (resource) is in range
** DONE Production will consume a tree
** DONE The production limit is not used, lumberjack produces until full
*** guy moves to the tree and then the production starts? (later)

* DONE Stop production, if 3 produced items are in storage
* DONE Produce does not check if items are requirements are fulfilled
** DONE Requests items for production
*** DONE Add a new step in tick which scans production buildings and sets a request if production storage is empty and no request is pending
*** DONE if building is finished
*** DONE only request stuff for the next production, not two more
** DONE Remove items at the start of production
* Reduce townhall start resources to 2 Wood

TestSetup
** Maybe use of Hilt is better?

Transport

* Add a flag to buildings when a transport is started to a specific building. Prefer buildings where the transports is already in progress. to prevent rerouting of items.
* WONTFIX Currently only the stuff in front of the required queue is requested. I.e. pyramid: lumber+stone are requested. stone is only requested if all lumber is already there. This is hard to do, because touched is only set, after the GameState is applied. This is after the moveResource step.
* Transport is blocked if any field in the path is blocked. It should transport right before the next field
** What happens if the route of an active transport is interrrupted
* Transport priorities are needed
* Ammu < Wood

Routing
* Sometimes buildings request items from a previous transport, then it flickers between two buildings
** Maybe ignore touched here better? Or is it because it gets to a boundary where multiple paths have the same distance?

UI

--------------------------------------------------------------------------------------------------
M1 MVP

* Name - Idea "Township Survival"
* Design MVP which is playable
** Gameloop
*** What are must have buildings
**** (Townhall) Storage
**** (Lumberjack) Material
**** (Defensetower) Shoot zombies
**** (Fletcher) Produces ammo
***
** Goal
*** Build Monument
** Obstacles
*** Enemy spawners
**** Send waves
** Pixelart Graphics
** Scrollable map
*** Run on small phones to see if the scrollable map works
*** ALternative is some grid system, which expands to a single cell on a bigger grid

M2 Playstore
* Make App Icon
* Write Description Text
* Configure Setting
* Launch

M3 Add features